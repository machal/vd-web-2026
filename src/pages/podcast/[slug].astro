---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const podcasts = await getCollection('podcast');
  return podcasts.map((podcast) => ({
    params: { slug: podcast.slug },
    props: { podcast },
  }));
}

const { podcast } = Astro.props;
const { Content } = await podcast.render();

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('cs-CZ', {
    day: 'numeric',
    month: 'numeric',
    year: 'numeric',
  }).format(date);
}
---

<BaseLayout
  title={podcast.data.title}
  description={podcast.data.description}
  ogType="article"
  ogUrl={`https://www.vzhurudolu.cz/podcast/${podcast.slug}`}
  bodyClass="section-podcast"
>
  <Header />
  
  <main role="main" id="main" aria-label="Hlavní obsah">
    <div class="page-head page-head--subhead">
      <h1>{podcast.data.title}</h1>
    </div>

    <div class="page-subhead">
      <p class="mb-0 page-subhead__meta">
        <a class="page-subhead__author" href="/martin">
          <span class="avatar avatar--tiny avatar--inline mr-05">
            <img src="/assets/img/content/lectors/shoulders-martin-michalek_50x50.png" alt="Martin Michálek" width="50" height="50" class="avatar__image" />
          </span>
          {podcast.data.author}
        </a>
        <span class="page-subhead__date">
          &nbsp;&ndash;
          {formatDate(podcast.data.date)}
        </span>
      </p>
    </div>

    {podcast.data.audioUrl && (
      <div class="content">
        <audio controls>
          <source src={podcast.data.audioUrl} type="audio/mpeg" />
          Váš prohlížeč nepodporuje audio přehrávač.
        </audio>
      </div>
    )}

    <article class="content">
      <Content />
    </article>
  </main>
  
  <Footer />
  
  <script is:inline src="/assets/js/vrdl.min.js"></script>
</BaseLayout>
