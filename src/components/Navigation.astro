---
// Univerzální navigační komponenta s automatickou detekcí aktivní sekce
interface Props {
  activeSection?: 'home' | 'podcast' | 'ebook' | 'video' | null;
}

const { activeSection: explicitActiveSection } = Astro.props;

// Automatická detekce aktivní sekce podle URL
function detectActiveSection(url: URL): 'home' | 'podcast' | 'ebook' | 'video' | null {
  const pathname = url.pathname;
  
  // Info stránky bez aktivní sekce v navigaci
  const infoPages = [
    '/martin',
    '/o-webu',
    '/podminky',
    '/osobni-udaje',
    '/cookies',
    '/email',
    '/404',
  ];
  
  if (infoPages.includes(pathname)) {
    return null;
  }
  
  // Podcast sekce
  if (pathname.startsWith('/podcast')) {
    return 'podcast';
  }
  
  // Video sekce
  if (pathname.startsWith('/video')) {
    return 'video';
  }
  
  // E-booky sekce
  if (
    pathname.startsWith('/ebooky') ||
    pathname.startsWith('/css-layout') ||
    pathname.startsWith('/kniha-responzivni-design') ||
    pathname.startsWith('/ebook-amp') ||
    pathname.startsWith('/ebook-css3')
  ) {
    return 'ebook';
  }
  
  // Home sekce (články, blog, příručka, homepage)
  // Toto je default, takže pokrývá:
  // - / (homepage)
  // - /blog/*
  // - /prirucka/*
  // - a všechny ostatní stránky
  return 'home';
}

// Použij explicitní hodnotu, pokud je poskytnuta, jinak automatická detekce
const activeSection = explicitActiveSection !== undefined ? explicitActiveSection : detectActiveSection(Astro.url);

// Definice navigačních položek
const navItems = [
  {
    id: 'home' as const,
    label: 'Články',
    href: '/',
    colorClass: 'color-home',
  },
  {
    id: 'podcast' as const,
    label: 'Podcast',
    href: '/podcast',
    colorClass: 'color-podcast',
  },
  {
    id: 'ebook' as const,
    label: 'Knihy',
    href: '/ebooky',
    colorClass: 'color-ebook',
  },
  {
    id: 'video' as const,
    label: 'Video',
    href: '/video',
    colorClass: 'color-video',
  },
];
---

<nav class="nav nav--site p-r" aria-labelledby="nav-heading" role="navigation">
  <h2 class="nav__heading sr-only" id="nav-heading">Hlavní navigace</h2>
  <ul class="nav__list">
    {navItems.map((item) => {
      const isActive = activeSection === item.id;
      return (
        <li class={`nav__item ${isActive ? 'nav__item--active' : ''} f-6`}>
          {/* Aktivní položka je stále klikatelná a vede na homepage sekce */}
          <a 
            class={`nav__item-in ${item.colorClass}`}
            href={item.href}
            aria-current={isActive ? 'page' : undefined}
          >
            {item.label}
          </a>
        </li>
      );
    })}
  </ul>
</nav>
